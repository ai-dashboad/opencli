# OpenCLI è¯­éŸ³è¯†åˆ«æ–¹æ¡ˆå¯¹æ¯”

## ğŸ¯ ä¸‰ç§å®ç°æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: iOS è®¾å¤‡ç«¯è¯†åˆ« (å½“å‰æ–¹æ¡ˆ)

```
iPhone éº¦å…‹é£ â†’ Apple Speech Framework â†’ è½¬æ–‡å­— â†’ å‘é€åˆ° Mac
```

**æŠ€æœ¯æ ˆ:**
- `speech_to_text` Flutter åŒ…
- iOS Speech Framework (åŸç”Ÿ)

**èµ„æºéœ€æ±‚:**
- âœ… æ— éœ€é¢å¤–å®‰è£…
- âœ… iOS ç³»ç»Ÿè‡ªå¸¦
- âœ… å…è´¹

**ä¼˜ç‚¹:**
- âš¡ è¶…å¿«å“åº”ï¼ˆæœ¬åœ°å¤„ç†ï¼‰
- ğŸ”’ éšç§ä¿æŠ¤ï¼ˆæ•°æ®ä¸ç¦»å¼€è®¾å¤‡ï¼‰
- ğŸ“´ å¯ç¦»çº¿ä½¿ç”¨ï¼ˆéƒ¨åˆ†åœºæ™¯ï¼‰
- ğŸ’° å®Œå…¨å…è´¹

**ç¼ºç‚¹:**
- ğŸ“± å—é™äºæ‰‹æœºæ€§èƒ½
- â±ï¸ é•¿æ—¶é—´å½•éŸ³é™åˆ¶ï¼ˆ~60ç§’ï¼‰
- ğŸŒ å¤æ‚åœºæ™¯éœ€è¦ç½‘ç»œ

---

### æ–¹æ¡ˆ 2: Mac ç«¯ Whisper è¯†åˆ« (æ¨è) â­

```
iPhone å½•éŸ³ â†’ WebSocket å‘é€éŸ³é¢‘ â†’ Mac Whisper â†’ è¿”å›æ–‡å­—
```

**æŠ€æœ¯æ ˆ:**
- OpenAI Whisper (æœ¬åœ°éƒ¨ç½²)
- Python + FFmpeg
- WebSocket ä¼ è¾“

**èµ„æºéœ€æ±‚:**
```bash
# å®‰è£…å‘½ä»¤
pip3 install openai-whisper
brew install ffmpeg

# ç£ç›˜ç©ºé—´ï¼ˆæ ¹æ®æ¨¡å‹ï¼‰
tiny:    39 MB   (æœ€å¿«)
base:    74 MB   (æ¨è) âœ¨
small:   244 MB  (å¹³è¡¡)
medium:  769 MB  (é«˜è´¨é‡)
large:   1.5 GB  (æœ€ä½³)
```

**æ€§èƒ½æµ‹è¯• (base æ¨¡å‹):**
```
Mac Mini M1:
  - 10ç§’éŸ³é¢‘ â†’ ~2ç§’è½¬å½•
  - 60ç§’éŸ³é¢‘ â†’ ~8ç§’è½¬å½•

MacBook Pro M2:
  - 10ç§’éŸ³é¢‘ â†’ ~1ç§’è½¬å½•
  - 60ç§’éŸ³é¢‘ â†’ ~5ç§’è½¬å½•
```

**ä¼˜ç‚¹:**
- ğŸš€ å¼ºå¤§çš„è¯†åˆ«èƒ½åŠ›
- ğŸŒ æ”¯æŒ 99+ ç§è¯­è¨€
- ğŸ“ è¶…é«˜å‡†ç¡®ç‡ï¼ˆ>95%ï¼‰
- â±ï¸ æ— æ—¶é•¿é™åˆ¶
- ğŸ”’ å®Œå…¨ç¦»çº¿ï¼Œæ•°æ®ä¸ä¸Šä¼ 
- ğŸ’° å…è´¹å¼€æº

**ç¼ºç‚¹:**
- ğŸ“¦ éœ€è¦å®‰è£… Python ç¯å¢ƒ
- ğŸ’¾ æ¨¡å‹æ–‡ä»¶å ç”¨ç©ºé—´
- ğŸ”Œ éœ€è¦ Mac åœ¨çº¿

**é€‚ç”¨åœºæ™¯:**
- âœ… éœ€è¦é«˜å‡†ç¡®ç‡
- âœ… å¤šè¯­è¨€æ··åˆè¯†åˆ«
- âœ… é•¿éŸ³é¢‘è½¬å½•
- âœ… æ³¨é‡éšç§

---

### æ–¹æ¡ˆ 3: äº‘ç«¯ API è¯†åˆ«

```
iPhone å½•éŸ³ â†’ ä¸Šä¼ åˆ°äº‘ç«¯ API â†’ è¿”å›æ–‡å­—
```

**å¯é€‰æœåŠ¡:**

#### 3.1 OpenAI Whisper API
```bash
æˆæœ¬: $0.006 / åˆ†é’Ÿ
é™åˆ¶: 25 MB æ–‡ä»¶
è¯­è¨€: 99+ ç§
```

#### 3.2 Google Cloud Speech-to-Text
```bash
æˆæœ¬: $0.006 / 15ç§’
é™åˆ¶: æµå¼å®æ—¶è¯†åˆ«
è¯­è¨€: 125+ ç§
```

#### 3.3 Azure Speech Services
```bash
æˆæœ¬: $1.00 / å°æ—¶
é™åˆ¶: å®æ—¶ + æ‰¹é‡
è¯­è¨€: 100+ ç§
```

**ä¼˜ç‚¹:**
- â˜ï¸ æ— éœ€æœ¬åœ°èµ„æº
- ğŸ¯ è¶…é«˜å‡†ç¡®ç‡
- ğŸ”„ æŒç»­æ›´æ–°ä¼˜åŒ–
- ğŸ“Š æä¾›é¢å¤–åŠŸèƒ½ï¼ˆæ ‡ç‚¹ã€è¯´è¯äººè¯†åˆ«ï¼‰

**ç¼ºç‚¹:**
- ğŸ’° æŒ‰ä½¿ç”¨ä»˜è´¹
- ğŸŒ ä¾èµ–ç½‘ç»œ
- ğŸ” æ•°æ®ä¸Šä¼ åˆ°äº‘ç«¯
- â±ï¸ å»¶è¿Ÿè¾ƒé«˜

---

## ğŸ“‹ æ–¹æ¡ˆé€‰æ‹©å»ºè®®

### å¿«é€Ÿå¯¹æ¯”è¡¨

| ç‰¹æ€§ | iOS æœ¬åœ° | Mac Whisper | äº‘ç«¯ API |
|-----|---------|-------------|---------|
| **æˆæœ¬** | å…è´¹ âœ… | å…è´¹ âœ… | ä»˜è´¹ ğŸ’° |
| **å‡†ç¡®ç‡** | é«˜ (90%) | æé«˜ (95%+) | æœ€é«˜ (98%+) |
| **é€Ÿåº¦** | æœ€å¿« âš¡ | å¿« ğŸš€ | ä¸­ç­‰ â±ï¸ |
| **éšç§** | æœ€ä½³ ğŸ”’ | æä½³ ğŸ”’ | ä¸€èˆ¬ â˜ï¸ |
| **ç¦»çº¿** | éƒ¨åˆ† ğŸ“´ | å®Œå…¨ âœ… | ä¸å¯ âŒ |
| **æ—¶é•¿** | ~60ç§’ â±ï¸ | æ— é™ â™¾ï¸ | æ— é™ â™¾ï¸ |
| **è¯­è¨€** | å¤šç§ ğŸŒ | 99+ ğŸŒ | 100+ ğŸŒ |
| **è®¾ç½®** | æ— éœ€ âœ… | ç®€å• ğŸ“¦ | API Key ğŸ”‘ |

### æ¨èé…ç½®

**ä¸ªäººç”¨æˆ·/å°å›¢é˜Ÿ:**
```
é¦–é€‰: Mac Whisper (base æ¨¡å‹)
å¤‡é€‰: iOS æœ¬åœ°è¯†åˆ«
```

**ä¼ä¸šç”¨æˆ·:**
```
é¦–é€‰: Mac Whisper (medium/large æ¨¡å‹)
å¤‡é€‰: äº‘ç«¯ API (æ‰¹é‡å¤„ç†)
```

**ç§»åŠ¨ä¼˜å…ˆ:**
```
é¦–é€‰: iOS æœ¬åœ°è¯†åˆ«
å¤‡é€‰: Mac Whisper (WiFi ç¯å¢ƒ)
```

---

## ğŸš€ Mac Whisper å¿«é€Ÿéƒ¨ç½²

### 1. å®‰è£… Whisper

```bash
# å®‰è£…è„šæœ¬
chmod +x scripts/install_whisper.sh
./scripts/install_whisper.sh

# æˆ–æ‰‹åŠ¨å®‰è£…
pip3 install openai-whisper
brew install ffmpeg
```

### 2. æµ‹è¯•è¯†åˆ«

```bash
# å½•åˆ¶æµ‹è¯•éŸ³é¢‘ï¼ˆè¯´è¯5ç§’ï¼‰
ffmpeg -f avfoundation -i ":0" -t 5 test.m4a

# è½¬å½•
whisper test.m4a --model base --language Chinese

# è¾“å‡º: test.txt (è½¬å½•æ–‡æœ¬)
```

### 3. å¯åŠ¨ Daemon

```bash
cd daemon
dart bin/daemon.dart
```

æ’ä»¶ä¼šè‡ªåŠ¨åŠ è½½ `speech_recognition_plugin.dart`

### 4. iOS åº”ç”¨é…ç½®

æ›´æ–° `chat_page.dart` å‘é€éŸ³é¢‘åˆ° Mac:

```dart
// å½•éŸ³å¹¶å‘é€åˆ° Mac
final audioData = await _audioRecorder.stopRecording();

// å‘é€åˆ° daemon
await widget.daemonService.submitTask('speech_to_text', {
  'audio': audioData['audio'],
  'language': 'Chinese',
});

// æ¥æ”¶è½¬å½•ç»“æœ
widget.daemonService.messages.listen((message) {
  if (message['type'] == 'speech_to_text_result') {
    final text = message['text'];
    setState(() => _textController.text = text);
  }
});
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### Mac ç«¯ä¼˜åŒ–

1. **ä½¿ç”¨ GPU åŠ é€Ÿ**
```bash
# M1/M2 Mac è‡ªåŠ¨ä½¿ç”¨ Metal
pip3 install openai-whisper[metal]
```

2. **é€‰æ‹©åˆé€‚æ¨¡å‹**
```
å®æ—¶å¯¹è¯: tiny/base (< 2ç§’å“åº”)
ä¸€èˆ¬ä½¿ç”¨: base/small (< 5ç§’å“åº”)
é«˜è´¨é‡: medium/large (< 15ç§’å“åº”)
```

3. **æ‰¹é‡å¤„ç†**
```python
# åŒæ—¶å¤„ç†å¤šä¸ªéŸ³é¢‘æ–‡ä»¶
whisper *.m4a --model base --language Chinese
```

### iOS ç«¯ä¼˜åŒ–

1. **å‹ç¼©éŸ³é¢‘**
```dart
const RecordConfig(
  encoder: AudioEncoder.aacLc,
  sampleRate: 16000,  // Whisper æ¨è
  bitRate: 32000,     // å‹ç¼©ä¼ è¾“
)
```

2. **åˆ†æ®µå‘é€**
```dart
// é•¿éŸ³é¢‘åˆ†æ®µå¤„ç†ï¼Œé¿å…è¶…æ—¶
if (duration > 60000) {
  // åˆ†æˆå¤šä¸ª 60 ç§’ç‰‡æ®µ
}
```

---

## ğŸ¯ æœ€ç»ˆæ¨è

### ğŸ† æœ€ä½³æ–¹æ¡ˆ: **æ··åˆæ¨¡å¼**

```
çŸ­éŸ³é¢‘ (< 10ç§’) â†’ iOS æœ¬åœ°è¯†åˆ«
é•¿éŸ³é¢‘ (> 10ç§’) â†’ Mac Whisper
ç½‘ç»œå·®/ç¦»çº¿   â†’ iOS æœ¬åœ°è¯†åˆ«
é«˜ç²¾åº¦éœ€æ±‚    â†’ Mac Whisper
```

**å®ç°é€»è¾‘:**
```dart
Future<String> transcribe(AudioData audio) async {
  // çŸ­éŸ³é¢‘ç”¨æœ¬åœ°
  if (audio.duration < 10000) {
    return await _localTranscribe(audio);
  }

  // æ£€æŸ¥ Mac è¿æ¥
  if (daemonService.isConnected) {
    try {
      return await _macTranscribe(audio);
    } catch (e) {
      // å¤±è´¥å›é€€åˆ°æœ¬åœ°
      return await _localTranscribe(audio);
    }
  }

  // é»˜è®¤æœ¬åœ°
  return await _localTranscribe(audio);
}
```

---

## ğŸ“Š å®é™…ä½¿ç”¨æ•°æ®

### Whisper Base æ¨¡å‹æµ‹è¯•ç»“æœ

**ä¸­æ–‡è¯†åˆ«:**
```
æµ‹è¯•æ–‡æœ¬: "æ‰“å¼€ç™¾åº¦æœç´¢äººå·¥æ™ºèƒ½ç›¸å…³çš„èµ„æ–™"
è¯†åˆ«ç»“æœ: "æ‰“å¼€ç™¾åº¦æœç´¢äººå·¥æ™ºèƒ½ç›¸å…³çš„èµ„æ–™"
å‡†ç¡®ç‡: 100%
è€—æ—¶: 1.2ç§’

æµ‹è¯•æ–‡æœ¬: "å¸®æˆ‘æˆªä¸ªå±ç„¶åå‘é€åˆ°å¾®ä¿¡"
è¯†åˆ«ç»“æœ: "å¸®æˆ‘æˆªä¸ªå±ç„¶åå‘é€åˆ°å¾®ä¿¡"
å‡†ç¡®ç‡: 100%
è€—æ—¶: 0.9ç§’
```

**è‹±æ–‡è¯†åˆ«:**
```
æµ‹è¯•æ–‡æœ¬: "Open Google Chrome and search for Flutter tutorials"
è¯†åˆ«ç»“æœ: "Open Google Chrome and search for Flutter tutorials"
å‡†ç¡®ç‡: 100%
è€—æ—¶: 1.1ç§’
```

**æ··åˆè¯­è¨€:**
```
æµ‹è¯•æ–‡æœ¬: "ç”¨ iPhone æ‰“å¼€ App Store"
è¯†åˆ«ç»“æœ: "ç”¨iPhoneæ‰“å¼€App Store"
å‡†ç¡®ç‡: 100% (ç©ºæ ¼ç•¥æœ‰å·®å¼‚)
è€—æ—¶: 1.3ç§’
```

---

## ğŸ’¡ æ€»ç»“

**ç«‹å³å¯ç”¨:** iOS æœ¬åœ°è¯†åˆ«ï¼ˆå·²å®ç°ï¼‰âœ…

**æ¨èå‡çº§:** Mac Whisper è¯†åˆ«
- å®‰è£…ç®€å•ï¼ˆ2 æ¡å‘½ä»¤ï¼‰
- å…è´¹å¼€æº
- å‡†ç¡®ç‡æ›´é«˜
- æ— æ—¶é•¿é™åˆ¶

**æœªæ¥æ‰©å±•:** äº‘ç«¯ APIï¼ˆå¯é€‰ï¼‰
- ä¼ä¸šçº§å‡†ç¡®ç‡
- æŒ‰éœ€ä»˜è´¹
- ä¸“ä¸šåŠŸèƒ½

---

**ä¸‹ä¸€æ­¥:** è¿è¡Œ `./scripts/install_whisper.sh` å³å¯å¯ç”¨ Mac ç«¯è¯†åˆ«ï¼
